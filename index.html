<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ativação do Curso</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container" id="container">
    <!-- Conteúdo será carregado aqui -->
  </div>

  <!-- 1. Primeiro carregue o Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <script>
    // 2. Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAhD-K0KUEH-jc6t3HKGa5zQVwt8dTM6H4",
      authDomain: "cursoprecificacao-464f0.firebaseapp.com",
      projectId: "cursoprecificacao-464f0",
      storageBucket: "cursoprecificacao-464f0.appspot.com",
      messagingSenderId: "835557952690",
      appId: "1:835557952690:web:d2e6f84856d5eec1084dab"
    };

    // 3. Inicialize o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // 4. Verifique se o Firebase foi carregado
    console.log("Firebase carregado?", typeof firebase !== "undefined");
    
    // 5. Função para mostrar a tela de chave
    function mostrarTelaChave() {
      document.getElementById("container").innerHTML = `
        <div class="card mt-5" style="max-width: 500px; margin: 0 auto;">
          <div class="card-body">
            <h3 class="text-center mb-4">Ativação do Curso</h3>
            <input type="text" id="inputChave" class="form-control mb-3" placeholder="Digite sua chave" autofocus>
            <button id="btnValidar" class="btn btn-primary w-100">Validar</button>
            <div id="mensagem" class="mt-3"></div>
          </div>
        </div>
      `;
      
      document.getElementById("btnValidar").addEventListener("click", validarChave);
    }

    // 6. Função para validar a chave
    async function validarChave() {
      const chave = document.getElementById("inputChave").value.trim();
      const mensagem = document.getElementById("mensagem");
      
      if(!chave) {
        mensagem.innerHTML = '<div class="alert alert-danger">Digite uma chave</div>';
        return;
      }
      
      try {
        const docRef = db.collection("chaves").doc(chave);
        const doc = await docRef.get();
        
        if(!doc.exists) {
          mensagem.innerHTML = '<div class="alert alert-danger">Chave inválida</div>';
          return;
        }
        
        mensagem.innerHTML = '<div class="alert alert-success">Chave válida! Redirecionando...</div>';
        setTimeout(() => {
          document.getElementById("container").innerHTML = `
            <div class="card mt-5" style="max-width: 500px; margin: 0 auto;">
              <div class="card-body text-center">
                <h3 class="text-success">Ativação concluída!</h3>
                <p>Chave: ${chave}</p>
              </div>
            </div>
          `;
        }, 2000);
        
      } catch(error) {
        console.error("Erro no Firebase:", error);
        mensagem.innerHTML = '<div class="alert alert-danger">Erro ao validar chave</div>';
      }
    }

    // 7. Inicie o aplicativo
    mostrarTelaChave();
  </script>
</body>
</html>